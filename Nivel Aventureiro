#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

// Structs e Constantes
typedef struct {
    char nome[30];
    char tipo[20];
    int prioridade; // 1 (alta) a 10 (baixa)
} Componente;

#define MAX_COMPONENTES 20
#define CHAVE_BUSCA "chip central"

Componente torre[MAX_COMPONENTES];
int numComponentes = 0;

// Prot√≥tipos
void inicializarDados();
void mostrarComponentes(const Componente c[], int t);
void trocar(Componente *a, Componente *b);
void processarOrdenacao(int opcao);
void executarBuscaBinaria();

// ------------------- Fun√ß√µes de Utilit√°rio -------------------

void trocar(Componente *a, Componente *b) {
    Componente temp = *a;
    *a = *b;
    *b = temp;
}

void mostrarComponentes(const Componente c[], int t) {
    printf("\n--- üì¶ Componentes Atuais (%d/%d) ---\n", t, MAX_COMPONENTES);
    if (t == 0) { printf("Nenhum componente cadastrado.\n"); return; }
    printf("+------------------------------+--------------------+--------------+\n");
    printf("| Nome do Componente           | Tipo               | Prioridade   |\n");
    printf("+------------------------------+--------------------+--------------+\n");
    for (int i = 0; i < t; i++) {
        printf("| %-28s | %-18s | %-12d |\n", c[i].nome, c[i].tipo, c[i].prioridade);
    }
    printf("+------------------------------+--------------------+--------------+\n");
}

void inicializarDados() {
    Componente dados[] = {
        {"cabo de forca", "suporte", 6},
        {"fusivel mestre", "controle", 2},
        {"chapa blindada", "suporte", 8},
        {"chip central", "controle", 1},
        {"propulsor auxiliar", "propulsao", 3},
        {"conexao logica", "controle", 4},
        {"combustivel", "propulsao", 7},
        {"antena", "controle", 5},
        {"base metalica", "suporte", 9}
    };
    numComponentes = sizeof(dados) / sizeof(Componente);
    memcpy(torre, dados, sizeof(dados));
    printf("\n‚úÖ %d componentes de teste carregados.\n", numComponentes);
}

// ------------------- Algoritmos de Ordena√ß√£o O(N^2) -------------------

void bubbleSortNome(Componente c[], int t, long long *comp) {
    *comp = 0;
    for (int i = 0; i < t - 1; i++) {
        for (int j = 0; j < t - 1 - i; j++) {
            (*comp)++;
            if (strcmp(c[j].nome, c[j + 1].nome) > 0) {
                trocar(&c[j], &c[j + 1]);
            }
        }
    }
}

void insertionSortTipo(Componente c[], int t, long long *comp) {
    *comp = 0;
    for (int i = 1; i < t; i++) {
        Componente chave = c[i];
        int j = i - 1;
        while (j >= 0) {
            (*comp)++;
            if (strcmp(c[j].tipo, chave.tipo) > 0) {
                c[j + 1] = c[j];
                j = j - 1;
            } else {
                break;
            }
        }
        c[j + 1] = chave;
    }
}

void selectionSortPrioridade(Componente c[], int t, long long *comp) {
    *comp = 0;
    for (int i = 0; i < t - 1; i++) {
        int min_idx = i;
        for (int j = i + 1; j < t; j++) {
            (*comp)++;
            if (c[j].prioridade < c[min_idx].prioridade) {
                min_idx = j;
            }
        }
        if (min_idx != i) {
            trocar(&c[i], &c[min_idx]);
        }
    }
}

// ------------------- Busca O(log N) -------------------

int buscaBinariaPorNome(const Componente c[], int t, const char chave[], long long *comp) {
    *comp = 0;
    int inicio = 0;
    int fim = t - 1;
    while (inicio <= fim) {
        int meio = (inicio + fim) / 2;
        (*comp)++;
        int res = strcmp(c[meio].nome, chave);
        if (res == 0) return meio;
        if (res < 0) inicio = meio + 1;
        else fim = meio - 1;
    }
    return -1;
}

// ------------------- Execu√ß√£o e Menu -------------------

void processarOrdenacao(int opcao) {
    clock_t start, end;
    long long comparacoes = 0;
    char *titulo;

    start = clock();
    switch (opcao) {
        case 1: bubbleSortNome(torre, numComponentes, &comparacoes); titulo = "Bubble Sort (Nome)"; break;
        case 2: insertionSortTipo(torre, numComponentes, &comparacoes); titulo = "Insertion Sort (Tipo)"; break;
        case 3: selectionSortPrioridade(torre, numComponentes, &comparacoes); titulo = "Selection Sort (Prioridade)"; break;
    }
    end = clock();

    printf("\n--- üìù Resultado da Ordena√ß√£o: %s ---\n", titulo);
    mostrarComponentes(torre, numComponentes);
    printf("--- üìä An√°lise de Desempenho ---\n");
    printf("Compara√ß√µes: %lld\n", comparacoes);
    printf("Tempo (s): %f\n", ((double) (end - start)) / CLOCKS_PER_SEC);
}

void executarBuscaBinaria() {
    printf("\n--- üöÄ Busca Bin√°ria do Componente-Chave ---\n");
    // Garante que o vetor esteja ordenado por nome
    processarOrdenacao(1); 
    
    long long comparacoes = 0;
    clock_t start = clock();
    int posicao = buscaBinariaPorNome(torre, numComponentes, CHAVE_BUSCA, &comparacoes);
    clock_t end = clock();

    printf("Componente-Chave Procurado: **%s**\n", CHAVE_BUSCA);
    if (posicao != -1) {
        printf("‚úÖ **Componente ENCONTRADO!** Posi√ß√£o: %d\n", posicao);
    } else {
        printf("‚ùå Componente-Chave n√£o encontrado!\n");
    }
    
    printf("--- üìä An√°lise de Desempenho da Busca ---\n");
    printf("Compara√ß√µes: %lld\n", comparacoes);
    printf("Tempo (s): %f\n", ((double) (end - start)) / CLOCKS_PER_SEC);
}

void menuPrincipal() {
    int opcao;
    printf("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n");
    printf("‚ïë  üöÅ M√ìDULO AVAN√áADO: Montagem da Torre de Resgate üöÅ ‚ïë\n");
    printf("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");
    inicializarDados();
    do {
        mostrarComponentes(torre, numComponentes);
        printf("\n--- Escolha sua Estrat√©gia ---\n");
        printf("1. Bubble Sort (Nome)\n2. Insertion Sort (Tipo)\n3. Selection Sort (Prioridade)\n");
        printf("4. Buscar Componente-Chave (Busca Bin√°ria)\n0. Sair\nOp√ß√£o: ");
        if (scanf("%d", &opcao) != 1) { while (getchar() != '\n'); opcao = -1; continue; }

        if (opcao >= 1 && opcao <= 3) processarOrdenacao(opcao);
        else if (opcao == 4) executarBuscaBinaria();
        else if (opcao == 0) printf("\nüëã Jogo finalizado.\n");
        else printf("\nOp√ß√£o inv√°lida.\n");
    } while (opcao != 0);
}

int main() {
    menuPrincipal();
    return 0;
}